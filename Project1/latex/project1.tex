\documentclass[11pt]{article}

\usepackage[margin=1in]{geometry}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{hyperref}
\usepackage{graphicx}
\usepackage{parskip}
\graphicspath{ {./images/} }

\title{Project 1 Report - ME155C/ECE147C}
\author{Cole Giusto, Raaghav Thirumaligai, Tien Nguyen}
\date{\today}

\begin{document}
\maketitle

% ---------------------------------------------------
% Abstract
% ---------------------------------------------------
\begin{abstract}
% [Report] Abstract:
% Summarize the content of the entire document in one or two paragraphs.
% Focus on key achievements.
%
% Example structure:
% - One paragraph explaining the overall problem or project goal
% - One paragraph highlighting main results and conclusions
\end{abstract}

% ---------------------------------------------------
% 1. Introduction
% ---------------------------------------------------
\section{Introduction}
% [Report] Introduction:
% Should generally cover:
% 1) Brief, self-contained description of the basic problem 
% 2) Summary and references to prior/related work 
% 3) Short paragraph on organization of this report.

% Provide context on the overall goal of your project:
% - E.g., “This lab project deals with … [controller design / system identification / etc.]”
% - Summarize what is known or what has been done before.
% - Outline the subsequent sections.

% Example:
%  - 1 paragraph describing the problem
%  - 1 paragraph describing prior related work
%  - 1 paragraph summarizing your contributions and how the rest of the report is organized

% Insert note about the planning aspect (mentioned in [Report] “Plan ahead …”)
\label{sec:intro}


% ---------------------------------------------------
% 2. System Identification
% ---------------------------------------------------
\section{System Identification}
\label{sec:systemID}

% [Report] System description:
% “Briefly describe the model of the process you are controlling, 
% explain meaning of the variables, their units, control input(s), measured output(s).”

\subsection{Process to be controlled}
% [Report] Provide a concise description of:
% - The physical system
% - Notation for variables, units
% - Control input(s) and measured output(s)
% For example, mention x1, x2, etc., masses, motor parameters, etc.
% Possibly include a figure

The process we are controlling is a two cart system
connected by a spring. The system is driven by a motor that
applies a force $F$ to the first cart with mass $m_1$ [kg], and the second cart
with mass $m_2$ [kg] is connected to the first cart via a spring with spring constant $k$ [N/m].
In this system, $x_1$ [m] is the position of the first cart, and $x_2$ [m] is the position of the second cart.
The control input is the voltage $u := V$ [Volt] applied to the motor, and the measured output
is the position $y := x_2$ [m] of the second cart.
\begin{figure}[!ht]
\centering
\includegraphics[width=0.5\textwidth]{two-cart-system.png}
\caption{Two cart system}
\label{fig:two-cart-system}
\end{figure}

\subsection{Non-Parametric Identification}
% [Report] For the non-parametric approach:
% 1) Frequencies/amplitudes used and why
% 2) Plots with magnitude/phase
% 3) Comparison with parametric identification

\begin{figure}[!ht]
\centering
\includegraphics[width=\textwidth]{bodeid-corr.pdf}
\caption{Bode plot of the identified system using non-parametric identification}
\label{fig:bodeid_corr}
\end{figure}


\subsection{Parametric Identification}
% [Report] For the parametric approach:
% 1) Inputs used (square waves, chirp, etc.) and rationale
% 2) Plots showing input and output signals (representative examples)
% 3) Discussion of chosen model order, justification
% 4) Bode plots (magnitude and phase) of identified model
% 5) Comparison with non-parametric approach


\begin{figure}[!ht]
\centering
\includegraphics[width=\textwidth]{sysid-outputs.pdf}
\caption{Output signals of all experiments for parametric identification}
\label{fig:outputs-param}
\end{figure}


\begin{figure}[!ht]
\centering
\includegraphics[width=\textwidth]{sysid-errors-fig.pdf}
\caption{Normalized MSE and worst parameter standard deviation for different model orders}
\label{fig:errors-param}
\end{figure}


\begin{figure}[!ht]
\centering
\includegraphics[width=\textwidth]{bodeid-param.pdf}
\caption{Bode plot of the identified system using parametric identification}
\label{fig:bodeid_param}
\end{figure}

% ---------------------------------------------------
% 3. Controller Design
% ---------------------------------------------------
\clearpage
\section{Controller Design}
\label{sec:control}

\subsection{Design Methodology}

Next, we were tasked to design a controller for the system. We shot for an overshoot of less than 15\%
and a settling time of less than 2 seconds. To achieve this, we chose to use an LQR/LQG design. Using our 
identified model, we used Matlab to calculate the optimal LQR gains and Kalman filter. 

However, even with the optimal linear controller, the unmodelled dead zone of the motor still caused
there to be a large steady state error. To fix this, we added an integrator to the controller, which successfully
eliminated the steady state error. The final controller is an LQR/LQG controller in parallel with an integrator, which led
to a closed loop system with an adequate performance.
% [Report] Summarize the design approach:
% - Requirements (overshoot, settling time, etc.)
% - The control method chosen (PID, state-feedback, etc.)
% - Justification (why these gains, design trade-offs, etc.)
% - Possibly references to classical design or modern control design approaches

\subsection{Simulation Results}
% [Report] Provide:
% - Step response plots for the closed-loop system 
%   (using the identified model AND the nominal model from ECE147A&B, if relevant)
% - Bode plots for the closed-loop
% - Any relevant discussion about stability, noise, etc.
We simulated the closed-loop system in Simulink using the identified model. The frequency response
can be seen in Figure \ref{fig:bodecompsense}. The simulated step response is unstable, as 
seen in Figure \ref{fig:stepresponse}.


\begin{figure}
\centering
    \includegraphics[width=0.7\textwidth]{bodecompsense.pdf}
    \caption{Closed-loop frequency response (simulated)}
    \label{fig:bodecompsense}
\end{figure}
\begin{figure}
\centering
    \includegraphics[width=0.7\textwidth]{bodecompsenseStep.pdf}
    \caption{Closed-loop step response (simulated)}
    \label{fig:stepresponse}
\end{figure}

% ---------------------------------------------------
% 4. Closed-loop Performance
% ---------------------------------------------------
\section{Closed-loop Testing}
\label{sec:closedLoop}

% [Report] Summarize the experiments performed in the lab with the actual hardware:
% 1) Step response data: include overshoot, rise time, settling time, max control input
% 2) Frequency response identification for the closed-loop (how you performed it, the results)
% 3) Discuss any discrepancies between theoretical and experimental results 
%    and possible reasons for them

\subsection{Step Response Experiments}
% [Report] Include a relevant plot/table with performance metrics (overshoot, rise time, etc.)



\begin{figure}[!h]
\centering
\includegraphics[width=0.7\textwidth]{CLStepResponse.png}
\caption{Closed-loop step response}
\label{fig:CLStepResponse}
\end{figure}

\subsection{Closed-loop Frequency Response}
% [Report] Show how you identified the closed-loop frequency response
% (method used, plots, comparison with simulated predictions, etc.)



\begin{figure}[!ht]
\centering
\includegraphics[width=\textwidth]{CLFreqResp.png}
\caption{Closed-loop frequency response of the transfer function from reference to output}
\label{fig:CLFreqResponse}
\end{figure}




\begin{figure}[!ht]
\centering
\includegraphics[width=\textwidth]{CLFreqRespError.png}
\caption{Closed-loop frequency response of the transfer function from reference to error}
\label{fig:CLFreqResponseError}
\end{figure}



% ---------------------------------------------------
% 5. Conclusions and Future Work
% ---------------------------------------------------
\section{Conclusions and Future Work}
% [Report] This normally covers:
% 1) Summary of main project achievements
% 2) Outline of what else could be done with more time or resources

% ---------------------------------------------------
% References
% ---------------------------------------------------
\begin{thebibliography}{9}
% [Report] Place any references here. 
% Example usage:
% \bibitem{somePaper} Author(s). "Title of Paper." Journal/Conference. Year.
\end{thebibliography}

\end{document}
